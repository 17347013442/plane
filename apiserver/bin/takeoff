#!/bin/bash
set -e
python manage.py wait_for_db
python manage.py migrate

# Register instance
python bin/instance_registration.py
# Load the configuration variable
python bin/instance_configuration.py
# Create the default bucket
python bin/bucket_script.py

exec gunicorn -w $GUNICORN_WORKERS -k uvicorn.workers.UvicornWorker plane.asgi:application --bind 0.0.0.0:8000 --max-requests 1200 --max-requests-jitter 1000 --access-logfile -
