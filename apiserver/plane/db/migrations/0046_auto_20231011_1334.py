# Generated by Django 4.2.3 on 2023-10-11 13:34
import uuid
from django.db import migrations, models
import django.db.models.deletion
from django.conf import settings


def create_project_settings(apps, schema_editor):
    Project = apps.get_model("db", "Project")
    ProjectSetting = apps.get_model("db", "ProjectSetting")

    ProjectSetting.objects.bulk_create(
        [
            ProjectSetting(
                project=project,
                workspace_id=project.workspace_id,
                archive_in=project.archive_in,
                close_in=project.close_in,
                cycle_view=project.cycle_view,
                default_assignee=project.default_assignee,
                default_state=project.default_state,
                estimate=project.estimate,
                inbox_view=project.inbox_view,
                issue_views_view=project.issue_views_view,
                module_view=project.module_view,
                page_view=project.page_view,
                project_lead=project.project_lead,
            )
            for project in Project.objects.all()
        ],
        batch_size=1000,
    )


class Migration(migrations.Migration):

    dependencies = [
        ('db', '0045_issueactivity_epoch_workspacemember_issue_props_and_more'),
    ]

    operations = [
        migrations.CreateModel(
            name='ProjectSetting',
            fields=[
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='Created At')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='Last Modified At')),
                ('id', models.UUIDField(db_index=True, default=uuid.uuid4, editable=False, primary_key=True, serialize=False, unique=True)),
                ('module_view', models.BooleanField(default=True)),
                ('cycle_view', models.BooleanField(default=True)),
                ('issue_views_view', models.BooleanField(default=True)),
                ('page_view', models.BooleanField(default=True)),
                ('inbox_view', models.BooleanField(default=False)),
                ('archive_in', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(12)])),
                ('close_in', models.IntegerField(default=0, validators=[django.core.validators.MinValueValidator(0), django.core.validators.MaxValueValidator(12)])),
                ('created_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_created_by', to=settings.AUTH_USER_MODEL, verbose_name='Created By')),
                ('default_assignee', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='default_assignee', to=settings.AUTH_USER_MODEL)),
                ('default_state', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='default_state', to='db.state')),
                ('estimate', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='projects', to='db.estimate')),
                ('project', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='project_settings', to='db.project')),
                ('project_lead', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='project_lead', to=settings.AUTH_USER_MODEL)),
                ('updated_by', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='%(class)s_updated_by', to=settings.AUTH_USER_MODEL, verbose_name='Last Modified By')),
                ('workspace', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='project_settings', to='db.workspace')),
            ],
            options={
                'verbose_name': 'Project Settings',
                'verbose_name_plural': 'Project Settings',
                'db_table': 'project_settings',
                'ordering': ('-created_at',),
            },
        ),
        migrations.RunPython(create_project_settings),
        migrations.RemoveField(
            model_name='project',
            name='archive_in',
        ),
        migrations.RemoveField(
            name='close_in',
        ),
        migrations.RemoveField(
            model_name='project',
            name='cycle_view',
        ),
        migrations.RemoveField(
            model_name='project',
            name='default_assignee',
        ),
        migrations.RemoveField(
            model_name='project',
            name='default_state',
        ),
        migrations.RemoveField(
            model_name='project',
            name='description_html',
        ),
        migrations.RemoveField(
            model_name='project',
            name='description_text',
        ),
        migrations.RemoveField(
            model_name='project',
            name='estimate',
        ),
        migrations.RemoveField(
            model_name='project',
            name='inbox_view',
        ),
        migrations.RemoveField(
            model_name='project',
            name='issue_views_view',
        ),
        migrations.RemoveField(
            model_name='project',
            name='module_view',
        ),
        migrations.RemoveField(
            model_name='project',
            name='page_view',
        ),
        migrations.RemoveField(
            model_name='project',
            name='project_lead',
        ),
    ]
